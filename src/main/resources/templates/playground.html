<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8">
    <title>UKIDS | 놀이시설</title>
    <!-- Viewport-->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Favicon and Touch Icons-->
    <link rel="apple-touch-icon" sizes="180x180" th:href="@{/img/ukids/logo.jpg}">
    <link rel="icon" type="image/png" sizes="32x32" th:href="@{/img/ukids/logo.jpg}">
    <link rel="icon" type="image/png" sizes="16x16" th:href="@{/img/ukids/logo.jpg}">
    <link rel="manifest" th:href="@{/site.webmanifest}">
    <link rel="mask-icon" color="#fe6a6a" th:href="@{/safari-pinned-tab.svg}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <!-- Vendor Styles including: Font Icons, Plugins, etc.-->
    <link rel="stylesheet" media="screen" th:href="@{/vendor/simplebar/dist/simplebar.min.css}"/>
    <link rel="stylesheet" media="screen" th:href="@{/vendor/tiny-slider/dist/tiny-slider.css}"/>
    <link rel="stylesheet" media="screen" th:href="@{/vendor/drift-zoom/dist/drift-basic.min.css}"/>
    <link rel="stylesheet" media="screen" th:href="@{/vendor/lightgallery.js/dist/css/lightgallery.min.css}"/>
    
    <!-- Main Theme Styles + Bootstrap-->
    <link rel="stylesheet" media="screen" th:href="@{/css/theme.min.css}">
    <link rel="stylesheet" th:href="@{/css/header.css}">
    <link rel="stylesheet" th:href="@{/css/footer.css}">
    <link rel="stylesheet" th:href="@{/css/kinder-nursery.css}">
    <link rel="stylesheet" th:href="@{/css/playground.css}">

    <!-- Chart.js Script -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.7.0"></script>
    <!-- Kakao Map API Key -->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=ea2906121c01a1fdb00c5f47f35899a9&libraries=services"></script>
    <!--jquery-->
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <!-- 폰트 -->
    <style>
      @font-face {
        font-family: 'NanumSquareRound';
        src: url('https://cdn.jsdelivr.net/gh/projectnoonnu/noonfonts_two@1.0/NanumSquareRound.woff') format('woff');
        font-weight: normal;
        font-style: normal;
      }
  
      *{
        font-family: 'NanumSquareRound';
      }
      </style>
  </head>


  <body class="handheld-toolbar-enabled">
    
    <!-- 로그인 모달 관련  -->
    <div th:fragment="modal" th:replace="~{common :: modal}"></div>
    
    <main class="page-wrapper">
    
      <!-- 헤더 -->
      <header th:fragment="header" th:replace="~{common :: header}"></header>
      
      <!-- Page Title -->
      <section class="bg-position-center bg-size-cover py-5" style="background-image: url('img/ukids/놀이시설.jpg'); height: 300px;">
        <div class="pt-0 pb-5">
          <div class="container pt-0  pt-lg-0">
            <div class="mb-3 mb-lg-0 pt-lg-0">
              <nav aria-label="breadcrumb">
                <ol class="breadcrumb breadcrumb-light fw-bold fs-md flex-lg-nowrap justify-content-center justify-content-lg-end">
                  <li class="breadcrumb-item"><a class="text-nowrap" th:href="@{/}"><i class="ci-home"></i>유키즈</a></li>
                  <li class="breadcrumb-item text-light">아동 관련 시설</li>
                  <li class="breadcrumb-item text-nowrap text-pink" aria-current="page">놀이시설</li>
                </ol>
              </nav>
            </div>
          </div>
          <div class="container pt-5 pb-3 pt-lg-5 pb-lg-4">
            <div class="pe-lg-4 text-center text-lg-start">
              <h1 class="h2 text-light fw-bold mb-0">놀이시설</h1>
            </div>
          </div>
        </div>
      </section>
      
      <!-- Playground Search -->
      <section class="container mt-lg-n5 mb-5" style="z-index: 10;">
        <div class="container shadow-lg rounded-3 px-0">
          
          <!-- 놀이시설 검색 -->
          <form id="pg-search">
            <div class="bg-light rounded-3 p-4">
              <div class="d-flex align-items-center p-0">
                <div class="col-md-2 me-2">
               		 <h3 class="fs-base m-0 me-3">분류</h3>
                   <select class="form-select" id="type" name="type">
                    <option value="" th:selected="${#strings.equals(param.type, '')}">전체</option>
                    <option value="유원시설" th:selected="${#strings.equals(param.type, '유원시설')}">유원시설</option>
                    <option value="키즈카페" th:selected="${#strings.equals(param.type, '키즈카페')}">키즈카페</option>
                    <option value="놀이터_실내" th:selected="${#strings.equals(param.type, '놀이터_실내')}">놀이터_실내</option>
                    <option value="놀이터_실외" th:selected="${#strings.equals(param.type, '놀이터_실외')}">놀이터_실외</option>
                  </select>
                </div>
                <div class="col-md-2 me-2">
                	<h3 class="fs-base m-0 ms-2 me-3">지역</h3>
                  <select class="form-select" id="city" name="city" onchange="cityChange()">
                    <option value=" " th:selected="${#strings.equals(param.city, ' ')}">전체</option>
	                  <option value="서울" th:selected="${#strings.equals(param.city, '서울')}">서울특별시</option>
	                  <option value="부산" th:selected="${#strings.equals(param.city, '부산')}">부산광역시</option>
	                  <option value="대구" th:selected="${#strings.equals(param.city, '대구')}">대구광역시</option>
	                  <option value="인천" th:selected="${#strings.equals(param.city, '인천')}">인천광역시</option>
	                  <option value="광주" th:selected="${#strings.equals(param.city, '광주')}">광주광역시</option>
	                  <option value="대전" th:selected="${#strings.equals(param.city, '대전')}">대전광역시</option>
	                  <option value="울산" th:selected="${#strings.equals(param.city, '울산')}">울산광역시</option>
	                  <option value="세종" th:selected="${#strings.equals(param.city, '세종')}">세종특별자치시</option>
	                  <option value="경기" th:selected="${#strings.equals(param.city, '경기')}">경기도</option>
	                  <option value="강원" th:selected="${#strings.equals(param.city, '강원')}">강원도</option>
	                  <option value="충청북도" th:selected="${#strings.equals(param.city, '충청북도')}">충청북도</option>
	                  <option value="충청남도" th:selected="${#strings.equals(param.city, '충청남도')}">충청남도</option>
	                  <option value="전라북도" th:selected="${#strings.equals(param.city, '전라북도')}">전라북도</option>
	                  <option value="전라남도" th:selected="${#strings.equals(param.city, '전라남도')}">전라남도</option>
	                  <option value="경상북도" th:selected="${#strings.equals(param.city, '경상북도')}">경상북도</option>
	                  <option value="경상남도" th:selected="${#strings.equals(param.city, '경상남도')}">경상남도</option>
	                  <option value="제주" th:selected="${#strings.equals(param.city, '제주')}">제주특별자치도</option>
                  </select>
                </div>
                <div class="col-md-2 me-2">
                  <select class="form-select" id="town" name="town">
                    <option>전체</option>
                  </select>
                </div>
                <div class="col-md-5 ms-3">
                  <div class="input-group d-none d-lg-flex">
                    <i class="ci-search"></i>
                    <input type="text" class="form-control rounded ps-5 me-2" id="searchValue" name="searchValue" th:value="${param.searchValue}" placeholder="놀이시설을 검색하세요.">
                    <button class="btn btn-primary rounded fs-base py-0" type="submit" id="bt2">검색하기</button>
                  </div>
                </div>
              </div>
            </div>
          </form>

          <!-- 놀이시설 목록 -->
          <div id="pg-list" class="d-flex p-4 pt-0">
            <div class="col-lg-8 iframe-full-height-wrap rounded-start">
              <div id="kakao-map" style="width: 100%; height: 500px;"></div>
            </div>

            <div class="col-lg-4 rounded-end border" style="width: 395px; height: 500px;">
              <div class="d-flex justify-content-between align-items-center px-3 py-2">
                <h3 class="product-title fs-base m-1">검색목록<span class="ms-2" style="color: #e9525a;">0</span></h3>
              </div>
              <div class="border-top pt-0 mt-0"></div>
              <div class="overflow-auto" style="height: 455px;"></div>
            </div> 
          </div>
        </div>    
            
      </section>
    </main>
    
    
    <!-- Footer-->
    <footer th:fragment="footer" th:replace="~{common :: footer}"></footer>
    
    <!-- Toolbar for handheld devices (Default)-->
    <div class="handheld-toolbar"><div class="d-table table-layout-fixed w-100"><a class="d-table-cell handheld-toolbar-item" href="#" data-bs-toggle="offcanvas" data-bs-target="#shop-sidebar"><span class="handheld-toolbar-icon"><i class="ci-filter-alt"></i></span><span class="handheld-toolbar-label">Filters</span></a><a class="d-table-cell handheld-toolbar-item" href="account-wishlist.html"><span class="handheld-toolbar-icon"><i class="ci-heart"></i></span><span class="handheld-toolbar-label">Wishlist</span></a><a class="d-table-cell handheld-toolbar-item" href="javascript:void(0)" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" onclick="window.scrollTo(0, 0)"><span class="handheld-toolbar-icon"><i class="ci-menu"></i></span><span class="handheld-toolbar-label">Menu</span></a><a class="d-table-cell handheld-toolbar-item" href="shop-cart.html"><span class="handheld-toolbar-icon"><i class="ci-cart"></i><span class="badge bg-primary rounded-pill ms-1">4</span></span><span class="handheld-toolbar-label">$265.00</span></a></div></div>
    <!-- Back To Top Button-->
    <a class="btn-scroll-top" href="#top" data-scroll><span class="btn-scroll-top-tooltip text-muted fs-sm me-2">Top</span><i class="btn-scroll-top-icon ci-arrow-up">   </i></a>
    
    <!-- Vendor scrits: js libraries and plugins-->
    <script th:src="@{/vendor/bootstrap/dist/js/bootstrap.bundle.min.js}"></script>
    <script th:src="@{/vendor/simplebar/dist/simplebar.min.js}"></script>
    <script th:src="@{/vendor/tiny-slider/dist/min/tiny-slider.js}"></script>
    <script th:src="@{/vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js}"></script>
    <script th:src="@{/vendor/nouislider/dist/nouislider.min.js}"></script>
    <script th:src="@{/vendor/drift-zoom/dist/Drift.min.js}"></script>
    <script th:src="@{/vendor/lightgallery.js/dist/js/lightgallery.min.js}"></script>
    <script th:src="@{/vendor/lg-video.js/dist/lg-video.min.js}"></script>
    <script th:src="@{/vendor/flatpickr/dist/flatpickr.min.js}"></script>
    <script th:src="@{/vendor/flatpickr/dist/plugins/rangePlugin.js}"></script>
    
    <!-- Main theme script-->
    <script th:src="@{/js/theme.min.js}"></script>
    <script th:src="@{/js/address.js}"></script>
    
    
    <script type="text/javascript" th:inline="javascript">
    	/*<![CDATA[*/
    	$(function() {
				const urlParams = new URL(location.href).searchParams;
				var city = urlParams.get('city');
				if(city != '') {
					cityChange();
				}
			})
    		
			var searchList = [
				/*[# th:each="item : ${list}"]*/
			  {
				no: /*[[${item.NO}]]*/{},
			    type: /*[[${item.divM}]]*/{},
			    name: /*[[${item.pgName}]]*/{},
			    address: /*[[${item.pgAddr1}]]*/{},
			  },
			  /*[/]*/
			];
				
			/* ========== 카카오 지도 ========== */
			// 지도 생성
			var mapContainer = document.getElementById('kakao-map') 
			var mapOption = {
			  center: new kakao.maps.LatLng(37.541, 126.986), // 지도 중심좌표
			  level: 1 // 지도 확대 레벨
			};   
			var map = new kakao.maps.Map(mapContainer, mapOption); 
			
			
			// 각 객체의 주소값을 convertToLatLng() 함수의 매개변수로 넘기기
			searchList.forEach((item) => convertToLatLng(item.address));
			
			
			// 지도를 재설정할 범위정보를 가지고 있을 LatLngBounds 객체를 생성
			var bounds = new kakao.maps.LatLngBounds();
			
			
			//주소를 좌표로 변환
			count = 0;
			function convertToLatLng(address) {
			
			  //주소-좌표 변환 객체 생성
			  var geocoder = new kakao.maps.services.Geocoder();
			
			  //주소로 좌표 검색
			  geocoder.addressSearch(address, function(result, status) {
			
			    //정상적으로 검색이 완료됐으면
			    if (status === kakao.maps.services.Status.OK) {
			
			      // 좌표 생성
			      var coords = new kakao.maps.LatLng(result[0].y, result[0].x);
			
			      //결과값으로 받은 위치를 마커로 표시
			      var marker = new kakao.maps.Marker({
			        position: coords,
			        clickable: true,
			      });
			      marker.setMap(map);
			
			      // 마커에 표시할 인포윈도우를 생성
			      var infowindow = new kakao.maps.InfoWindow({
			        content: 
			          `<div class="marker-box">
			            <span class="info-type">${searchList[count].type}</span>
			            <div><span class="info-name">${searchList[count].name}</span></div>
			            <span class="info-addr text-truncate"><i class="ci-location"></i>${searchList[count].address}</span>
			          </div>`,
			        removable: true,
			      });
			
			      // 마커 클릭하면 인포뒤도우 표시
			      kakao.maps.event.addListener(marker, 'click', function() {
			        infowindow.open(map, marker);  
			      });
			
			      // 검색 결과에 맞게 지도 범위 재설정
			      bounds.extend(coords);
			      map.setBounds(bounds);
			
			      count++;
			    }    
			  });
			}
				
			/* ========== 사이드바 목록 ========== */
			const sidebar = document.querySelector('#pg-list .overflow-auto');
			const searchCount = document.querySelector('#pg-list .product-title span');
			
			searchCount.innerHTML = searchList.length;
			
			searchList.forEach((item) => {
			  sidebar.innerHTML += 
			  `<div class="card product-card product-list">
			    <div class="card-body py-2">
			      <div class="product-price"><span class="text-accent"><small>${item.type}</small></span></div>
			      <h3 class="product-title fs-base mt-1 mb-2">${item.name}</h3>
			      <span class="product-meta d-block fs-xs pb-1 text-truncate"><i class="ci-location me-1"></i>${item.address}</span>
			    </div>
			   </div><div class="border-top pt-0 mt-0"></div>`
			});
    	/*]]>*/
    </script>
    
  </body>
</html>